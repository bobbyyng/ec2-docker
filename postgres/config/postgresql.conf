# PostgreSQL Configuration File
# This file contains settings for PostgreSQL 18

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

# Connection pool settings
max_connections = 100                    # Maximum number of concurrent connections
superuser_reserved_connections = 3       # Connections reserved for superusers

#------------------------------------------------------------------------------
# MEMORY SETTINGS
#------------------------------------------------------------------------------

# Shared memory settings
shared_buffers = 256MB                   # Shared memory buffers (adjust based on EC2 instance RAM)
effective_cache_size = 1GB               # Effective cache size (typically 50-75% of total RAM)
maintenance_work_mem = 64MB              # Memory for maintenance operations
work_mem = 4MB                           # Memory for query operations (per operation)

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

# Planner settings
random_page_cost = 1.1                   # Cost of random page access (lower for SSD)
effective_io_concurrency = 200           # Concurrent I/O operations (SSD recommended: 200)

#------------------------------------------------------------------------------
# WRITE-AHEAD LOG
#------------------------------------------------------------------------------

wal_buffers = 16MB                       # WAL buffers
min_wal_size = 1GB                       # Minimum WAL size
max_wal_size = 4GB                       # Maximum WAL size
checkpoint_completion_target = 0.9       # Checkpoint completion target

#------------------------------------------------------------------------------
# REPLICATION
#------------------------------------------------------------------------------

# Uncomment and configure if replication is needed
# max_wal_senders = 3
# wal_keep_size = 1GB

#------------------------------------------------------------------------------
# LOGGING
#------------------------------------------------------------------------------

logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_min_duration_statement = 1000        # Log queries taking longer than 1 second
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

#------------------------------------------------------------------------------
# LOCALE AND FORMATTING
#------------------------------------------------------------------------------

datestyle = 'iso, mdy'
timezone = 'UTC'                    # PostgreSQL timezone (can be overridden by TZ env var or set to specific timezone like 'Asia/Hong_Kong')
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'
